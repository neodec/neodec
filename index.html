<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEODEC - Conseil en Data & BI</title>
  <link rel="stylesheet" href="style.css" />
  <script>
    if (location.hostname === 'neodec.fr') {
      location.replace('https://www.neodec.fr' + location.pathname + location.search + location.hash);
    }
  </script>
  <!-- Intégration reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Lc524grAAAAAE3kuVMeyXsRo706ZFqtjULe3JcR"></script>
</head>
<body>

<header>
  <!-- Ton header ici -->
</header>

<!-- Tes autres sections ici -->

<section id="contact">
  <h2>Contactez-nous</h2>
  <form id="contactForm">
    <input type="text" name="Nom" placeholder="Votre nom" required />
    <input type="email" name="Email" placeholder="Votre email" required />
    <textarea name="Message" placeholder="Votre message" rows="5" required></textarea>

    <!-- Honeypot anti-spam : champ caché -->
    <input type="text" name="_gotcha" style="display:none" />

    <button type="submit">Envoyer</button>
  </form>
  <p id="formMessage" style="color: green; display:none;"></p>
</section>

<footer>
  <!-- Ton footer ici -->
</footer>

<script>
  const form = document.getElementById('contactForm');
  const formMessage = document.getElementById('formMessage');

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    // Si honeypot rempli => spam, stop
    if (form._gotcha.value) {
      return;
    }

    grecaptcha.ready(function() {
      grecaptcha.execute('6Lc524grAAAAAE3kuVMeyXsRo706ZFqtjULe3JcR', {action: 'submit'}).then(function(token) {
        // Ajoute le token reCAPTCHA au formulaire avant envoi
        const formData = new FormData(form);
        formData.append('g-recaptcha-response', token);

        // Envoie via fetch en POST
        fetch('https://formspree.io/f/xnnzjnyd', {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: formData
        })
        .then(response => {
          if (response.ok) {
            formMessage.textContent = "Merci pour votre message, nous vous répondrons rapidement.";
            formMessage.style.color = "green";
            formMessage.style.display = "block";
            form.reset();
          } else {
            response.json().then(data => {
              if (data && data.errors) {
                formMessage.textContent = data.errors.map(error => error.message).join(", ");
              } else {
                formMessage.textContent = "Une erreur est survenue lors de l'envoi.";
              }
              formMessage.style.color = "red";
              formMessage.style.display = "block";
            });
          }
        })
        .catch(() => {
          formMessage.textContent = "Une erreur réseau est survenue.";
          formMessage.style.color = "red";
          formMessage.style.display = "block";
        });
      });
    });
  });
</script>

</body>
</html>
